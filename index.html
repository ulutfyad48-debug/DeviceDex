<!DOCTYPE html>
<html lang="ur">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PeerChat - Ù…Ù‚Ø§Ù…ÛŒ Ù†ÛŒÙ¹ ÙˆØ±Ú© Ú†ÛŒÙ¹</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        :root {
            --primary: #4361ee;
            --secondary: #3a0ca3;
            --accent: #7209b7;
            --light: #f8f9fa;
            --dark: #212529;
            --success: #4cc9f0;
            --danger: #f72585;
            --warning: #f8961e;
            --gray: #6c757d;
        }
        
        body {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: var(--light);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .header {
            background: linear-gradient(90deg, var(--primary), var(--accent));
            padding: 25px;
            text-align: center;
            border-bottom: 3px solid rgba(255, 255, 255, 0.1);
        }
        
        .logo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-bottom: 10px;
        }
        
        .logo i {
            font-size: 2.5rem;
            background: rgba(255, 255, 255, 0.2);
            padding: 15px;
            border-radius: 50%;
        }
        
        h1 {
            font-size: 2.2rem;
            font-weight: 700;
            letter-spacing: 1px;
        }
        
        .tagline {
            font-size: 1.1rem;
            opacity: 0.9;
            margin-top: 5px;
        }
        
        .main-content {
            display: flex;
            min-height: 70vh;
        }
        
        .sidebar {
            width: 300px;
            background: rgba(0, 0, 0, 0.3);
            padding: 25px;
            border-right: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .avatar {
            width: 60px;
            height: 60px;
            background: linear-gradient(45deg, var(--primary), var(--accent));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            font-weight: bold;
            color: white;
        }
        
        .username {
            font-size: 1.3rem;
            font-weight: 600;
        }
        
        .status {
            font-size: 0.9rem;
            color: var(--success);
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .status-dot {
            width: 10px;
            height: 10px;
            background: var(--success);
            border-radius: 50%;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        .section-title {
            font-size: 1.1rem;
            margin: 25px 0 15px 0;
            color: var(--success);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .btn {
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            width: 100%;
            margin-bottom: 15px;
            transition: all 0.3s;
            font-size: 1rem;
        }
        
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 7px 15px rgba(67, 97, 238, 0.4);
        }
        
        .btn-success {
            background: linear-gradient(45deg, #4cc9f0, #4361ee);
        }
        
        .btn-danger {
            background: linear-gradient(45deg, #f72585, #b5179e);
        }
        
        .btn-warning {
            background: linear-gradient(45deg, #f8961e, #f3722c);
        }
        
        .connection-status {
            background: rgba(0, 0, 0, 0.4);
            padding: 15px;
            border-radius: 12px;
            margin-top: 20px;
            border-left: 4px solid var(--primary);
        }
        
        .status-text {
            font-size: 0.9rem;
            margin-bottom: 10px;
        }
        
        .chat-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: 25px;
        }
        
        .chat-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .chat-icon {
            font-size: 2rem;
            color: var(--primary);
        }
        
        .chat-title h2 {
            font-size: 1.8rem;
        }
        
        .chat-title p {
            color: var(--gray);
            font-size: 0.95rem;
        }
        
        .chat-messages {
            flex: 1;
            overflow-y: auto;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 25px;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .message {
            margin-bottom: 20px;
            max-width: 80%;
            animation: fadeIn 0.3s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .message-sent {
            margin-left: auto;
        }
        
        .message-received {
            margin-right: auto;
        }
        
        .message-bubble {
            padding: 15px 20px;
            border-radius: 20px;
            position: relative;
            word-wrap: break-word;
        }
        
        .message-sent .message-bubble {
            background: linear-gradient(45deg, var(--primary), var(--accent));
            border-top-right-radius: 5px;
            color: white;
        }
        
        .message-received .message-bubble {
            background: rgba(255, 255, 255, 0.1);
            border-top-left-radius: 5px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .message-sender {
            font-weight: 600;
            margin-bottom: 5px;
            font-size: 0.9rem;
        }
        
        .message-time {
            font-size: 0.75rem;
            opacity: 0.7;
            margin-top: 8px;
            text-align: right;
        }
        
        .message-input-container {
            display: flex;
            gap: 15px;
            align-items: center;
        }
        
        .message-input {
            flex: 1;
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            padding: 18px 20px;
            color: white;
            font-size: 1rem;
            outline: none;
            transition: all 0.3s;
        }
        
        .message-input:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(67, 97, 238, 0.3);
        }
        
        .input-actions {
            display: flex;
            gap: 10px;
        }
        
        .icon-btn {
            width: 55px;
            height: 55px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 1.2rem;
        }
        
        .icon-btn:hover {
            background: var(--primary);
            transform: scale(1.1);
        }
        
        .send-btn {
            background: linear-gradient(45deg, var(--primary), var(--accent));
            border: none;
        }
        
        .send-btn:hover {
            background: linear-gradient(45deg, var(--accent), var(--primary));
            box-shadow: 0 5px 15px rgba(67, 97, 238, 0.4);
        }
        
        .connected-users {
            margin-top: 30px;
        }
        
        .users-list {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .user-badge {
            background: rgba(67, 97, 238, 0.2);
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            border: 1px solid rgba(67, 97, 238, 0.3);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            padding: 30px;
            border-radius: 20px;
            width: 90%;
            max-width: 500px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }
        
        .modal-title {
            font-size: 1.8rem;
            color: var(--primary);
        }
        
        .close-modal {
            font-size: 1.8rem;
            cursor: pointer;
            color: var(--gray);
            transition: color 0.3s;
        }
        
        .close-modal:hover {
            color: var(--danger);
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
        }
        
        .form-input {
            width: 100%;
            padding: 15px;
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            color: white;
            font-size: 1rem;
        }
        
        .footer {
            text-align: center;
            padding: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            color: var(--gray);
            font-size: 0.9rem;
        }
        
        .peer-id-display {
            background: rgba(0, 0, 0, 0.4);
            padding: 12px;
            border-radius: 10px;
            margin-top: 10px;
            font-family: monospace;
            font-size: 0.9rem;
            word-break: break-all;
        }
        
        .call-controls {
            display: flex;
            gap: 15px;
            margin-top: 20px;
            justify-content: center;
        }
        
        .voice-active {
            background: var(--success) !important;
            animation: pulse 1.5s infinite;
        }
        
        .video-active {
            background: var(--primary) !important;
            animation: pulse 1.5s infinite;
        }
        
        @media (max-width: 768px) {
            .main-content {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                border-right: none;
                border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            }
            
            .chat-header {
                flex-direction: column;
                text-align: center;
            }
            
            .message {
                max-width: 90%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- ÛÛŒÚˆØ± -->
        <div class="header">
            <div class="logo">
                <i class="fas fa-satellite-dish"></i>
                <div>
                    <h1>PeerChat</h1>
                    <div class="tagline">Ù…Ù‚Ø§Ù…ÛŒ Ù†ÛŒÙ¹ ÙˆØ±Ú© Ù¾Ø± Ù…ÙØª Ú†ÛŒÙ¹ Ø§ÙˆØ± Ú©Ø§Ù„</div>
                </div>
            </div>
        </div>
        
        <!-- Ù…Ø±Ú©Ø²ÛŒ Ù…ÙˆØ§Ø¯ -->
        <div class="main-content">
            <!-- Ø³Ø§Ø¦ÛŒÚˆØ¨Ø§Ø± -->
            <div class="sidebar">
                <div class="user-info">
                    <div class="avatar" id="userAvatar">U</div>
                    <div>
                        <div class="username" id="username">Ù…ÛÙ…Ø§Ù†</div>
                        <div class="status">
                            <div class="status-dot"></div>
                            <span id="connectionStatus">Ù…Ù†Ø³Ù„Ú© Ù†ÛÛŒÚº</span>
                        </div>
                    </div>
                </div>
                
                <div class="section-title">
                    <i class="fas fa-wifi"></i>
                    <span>Ù†ÛŒÙ¹ ÙˆØ±Ú© Ú©Ù†Ú©Ø´Ù†</span>
                </div>
                
                <button class="btn btn-success" onclick="startPeerConnection()">
                    <i class="fas fa-plug"></i>
                    <span>Ú©Ù†Ú©Ø´Ù† Ø´Ø±ÙˆØ¹ Ú©Ø±ÛŒÚº</span>
                </button>
                
                <button class="btn" onclick="joinExistingConnection()">
                    <i class="fas fa-user-plus"></i>
                    <span>Ú©Ù†Ú©Ø´Ù† Ù…ÛŒÚº Ø´Ø§Ù…Ù„ ÛÙˆÚº</span>
                </button>
                
                <button class="btn btn-danger" onclick="disconnectPeer()">
                    <i class="fas fa-unlink"></i>
                    <span>Ú©Ù†Ú©Ø´Ù† Ù…Ù†Ù‚Ø·Ø¹ Ú©Ø±ÛŒÚº</span>
                </button>
                
                <div class="section-title">
                    <i class="fas fa-phone-alt"></i>
                    <span>Ú©Ø§Ù„ Ú©Û’ Ø§Ø®ØªÛŒØ§Ø±Ø§Øª</span>
                </div>
                
                <button class="btn" onclick="startVoiceCall()" id="voiceCallBtn">
                    <i class="fas fa-phone"></i>
                    <span>ÙˆØ§Ø¦Ø³ Ú©Ø§Ù„</span>
                </button>
                
                <button class="btn" onclick="startVideoCall()" id="videoCallBtn">
                    <i class="fas fa-video"></i>
                    <span>ÙˆÛŒÚˆÛŒÙˆ Ú©Ø§Ù„</span>
                </button>
                
                <div class="connection-status">
                    <div class="status-text" id="peerIdStatus">
                        Ø¢Ù¾ Ú©Ø§ Ù¾ÛŒØ¦Ø± Ø¢Ø¦ÛŒ ÚˆÛŒ: <span id="myPeerId">ØªÙˆÙ„ÛŒØ¯ ÛÙˆ Ø±ÛØ§ ÛÛ’...</span>
                    </div>
                    <div class="peer-id-display" id="peerIdDisplay">
                        Ú©Ù†Ú©Ø´Ù† Ø´Ø±ÙˆØ¹ Ú©Ø±Ù†Û’ Ú©Ø§ Ø§Ù†ØªØ¸Ø§Ø±...
                    </div>
                </div>
                
                <div class="connected-users">
                    <div class="section-title">
                        <i class="fas fa-users"></i>
                        <span>Ù…Ù†Ø³Ù„Ú© ØµØ§Ø±ÙÛŒÙ†</span>
                    </div>
                    <div class="users-list" id="usersList">
                        <div class="user-badge">
                            <i class="fas fa-user"></i>
                            <span>Ú©ÙˆØ¦ÛŒ ØµØ§Ø±Ù Ù†ÛÛŒÚº</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Ú†ÛŒÙ¹ Ø§ÛŒØ±ÛŒØ§ -->
            <div class="chat-container">
                <div class="chat-header">
                    <div class="chat-icon">
                        <i class="fas fa-comments"></i>
                    </div>
                    <div class="chat-title">
                        <h2>Ú¯Ø±ÙˆÙ¾ Ú†ÛŒÙ¹</h2>
                        <p>Ù¾ÛŒØºØ§Ù…Ø§Øª Ù…Ù‚Ø§Ù…ÛŒ Ù†ÛŒÙ¹ ÙˆØ±Ú© Ú©Û’ Ø°Ø±ÛŒØ¹Û’ Ø¨Ú¾ÛŒØ¬Û’ Ø¬Ø§ØªÛ’ ÛÛŒÚº</p>
                    </div>
                </div>
                
                <div class="chat-messages" id="chatMessages">
                    <div class="message message-received">
                        <div class="message-bubble">
                            <div class="message-sender">Ø³Ø³Ù¹Ù…</div>
                            <div class="message-content">Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯! PeerChat Ù…ÛŒÚº Ø¢Ù¾ Ú©Ø§ Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ ÛÛ’Û” Ú©Ù†Ú©Ø´Ù† Ø´Ø±ÙˆØ¹ Ú©Ø±Ù†Û’ Ú©Û’ Ù„ÛŒÛ’ Ø¨Ø§Ø¦ÛŒÚº Ù¾ÛŒÙ†Ù„ Ú©Û’ Ø¨Ù¹Ù† Ø§Ø³ØªØ¹Ù…Ø§Ù„ Ú©Ø±ÛŒÚºÛ”</div>
                            <div class="message-time">Ø§Ø¨Ú¾ÛŒ</div>
                        </div>
                    </div>
                </div>
                
                <div class="message-input-container">
                    <input type="text" class="message-input" id="messageInput" placeholder="Ø§Ù¾Ù†Ø§ Ù¾ÛŒØºØ§Ù… ÛŒÛØ§Úº Ù„Ú©Ú¾ÛŒÚº..." onkeypress="handleKeyPress(event)">
                    
                    <div class="input-actions">
                        <div class="icon-btn" onclick="toggleVoiceRecording()" id="voiceBtn">
                            <i class="fas fa-microphone"></i>
                        </div>
                        <div class="icon-btn" onclick="sendEmoji()">
                            <i class="far fa-smile"></i>
                        </div>
                        <div class="icon-btn send-btn" onclick="sendMessage()">
                            <i class="fas fa-paper-plane"></i>
                        </div>
                    </div>
                </div>
                
                <div class="call-controls" id="callControls" style="display:none;">
                    <div class="icon-btn" onclick="toggleVoiceCall()" id="toggleVoiceBtn">
                        <i class="fas fa-phone"></i>
                    </div>
                    <div class="icon-btn" onclick="toggleVideoCall()" id="toggleVideoBtn">
                        <i class="fas fa-video"></i>
                    </div>
                    <div class="icon-btn btn-danger" onclick="endCall()">
                        <i class="fas fa-phone-slash"></i>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- ÙÙˆÙ¹Ø± -->
        <div class="footer">
            <div>PeerChat - Ù…Ù‚Ø§Ù…ÛŒ Ù†ÛŒÙ¹ ÙˆØ±Ú© Ù¾Ø± Ù…Ú©Ù…Ù„ Ù…ÙØª Ú†ÛŒÙ¹</div>
            <div style="margin-top: 5px;">ÙˆÛŒØ¨ Ø¢Ø± Ù¹ÛŒ Ø³ÛŒ Ú©Û’ Ø°Ø±ÛŒØ¹Û’ ÚˆÛŒÙˆØ§Ø¦Ø³Ø² Ú©Ùˆ Ø¬ÙˆÚ‘ØªØ§ ÛÛ’ | Ù¾ÛÙ„ÛŒ Ø¨Ø§Ø± Ø§Ù†Ù¹Ø±Ù†ÛŒÙ¹ Ú©ÛŒ Ø¶Ø±ÙˆØ±Øª ÛÛ’</div>
        </div>
    </div>
    
    <!-- Ù…Ø§ÚˆÙ„Ø² -->
    <div class="modal" id="usernameModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Ø§Ù¾Ù†Ø§ Ù†Ø§Ù… Ø¯Ø±Ø¬ Ú©Ø±ÛŒÚº</div>
                <div class="close-modal" onclick="closeModal('usernameModal')">&times;</div>
            </div>
            <div class="form-group">
                <label class="form-label" for="usernameInput">Ø¢Ù¾ Ú©Ø§ Ù†Ø§Ù…:</label>
                <input type="text" class="form-input" id="usernameInput" placeholder="Ù…Ø«Ù„Ø§Ù‹: Ø¹Ù„ÛŒ" value="ØµØ§Ø±Ù">
            </div>
            <button class="btn btn-success" onclick="saveUsername()" style="width:100%;">
                <i class="fas fa-check"></i>
                <span>Ù…Ø­ÙÙˆØ¸ Ú©Ø±ÛŒÚº</span>
            </button>
        </div>
    </div>
    
    <div class="modal" id="connectModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Ú©Ù†Ú©Ø´Ù† Ø¨Ù†Ø§Ø¦ÛŒÚº</div>
                <div class="close-modal" onclick="closeModal('connectModal')">&times;</div>
            </div>
            <div class="form-group">
                <label class="form-label" for="peerIdInput">Ø¯ÙˆØ³Ø±Û’ ØµØ§Ø±Ù Ú©Ø§ Ù¾ÛŒØ¦Ø± Ø¢Ø¦ÛŒ ÚˆÛŒ:</label>
                <input type="text" class="form-input" id="peerIdInput" placeholder="Ù¾ÛŒØ¦Ø± Ø¢Ø¦ÛŒ ÚˆÛŒ Ø¯Ø±Ø¬ Ú©Ø±ÛŒÚº">
                <div style="margin-top:10px; font-size:0.9rem; color:#aaa;">
                    Ø¢Ù¾ Ú©Ø§ Ù¾ÛŒØ¦Ø± Ø¢Ø¦ÛŒ ÚˆÛŒ: <span id="myPeerIdModal" style="font-family:monospace;"></span>
                </div>
            </div>
            <button class="btn btn-success" onclick="connectToPeer()" style="width:100%;">
                <i class="fas fa-link"></i>
                <span>Ù…Ù†Ø³Ù„Ú© ÛÙˆÚº</span>
            </button>
        </div>
    </div>
    
    <!-- Ø³Ú©Ø±Ù¾Ù¹ -->
    <script>
        // Ú¯Ù„ÙˆØ¨Ù„ Ù…ØªØºÛŒØ±Ø§Øª
        let peer = null;
        let myPeerId = null;
        let connections = {};
        let myUsername = "Ù…ÛÙ…Ø§Ù†";
        let mediaStream = null;
        let voiceActive = false;
        let videoActive = false;
        let peerConnection = null;
        let dataChannel = null;
        
        // Ø§ÛŒÙ¾ Ø´Ø±ÙˆØ¹ Ú©Ø±Ù†Û’ Ù¾Ø±
        document.addEventListener('DOMContentLoaded', function() {
            // ØµØ§Ø±Ù Ù†Ø§Ù… Ù…Ø§ÚˆÙ„ Ø¯Ú©Ú¾Ø§Ø¦ÛŒÚº
            setTimeout(() => {
                document.getElementById('usernameModal').style.display = 'flex';
            }, 500);
            
            // Ù¾ÛŒØ¦Ø± Ø¢Ø¦ÛŒ ÚˆÛŒ Ø¨Ù†Ø§Ø¦ÛŒÚº
            generatePeerId();
            
            // Ú©Ù†Ú©Ø´Ù† Ø§Ø³Ù¹ÛŒÙ¹Ø³ Ø§Ù¾ ÚˆÛŒÙ¹
            updateConnectionStatus();
        });
        
        // Ù¾ÛŒØ¦Ø± Ø¢Ø¦ÛŒ ÚˆÛŒ Ø¨Ù†Ø§Ù†Ø§
        function generatePeerId() {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
            let id = '';
            for (let i = 0; i < 8; i++) {
                id += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            myPeerId = id;
            document.getElementById('myPeerId').textContent = id;
            document.getElementById('myPeerIdModal').textContent = id;
            document.getElementById('peerIdDisplay').textContent = `Ø¢Ù¾ Ú©Ø§ ID: ${id}`;
        }
        
        // Ù…Ø§ÚˆÙ„ Ø¨Ù†Ø¯ Ú©Ø±Ù†Ø§
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }
        
        // ØµØ§Ø±Ù Ù†Ø§Ù… Ù…Ø­ÙÙˆØ¸ Ú©Ø±Ù†Ø§
        function saveUsername() {
            const input = document.getElementById('usernameInput').value.trim();
            if (input) {
                myUsername = input;
                document.getElementById('username').textContent = myUsername;
                document.getElementById('userAvatar').textContent = myUsername.charAt(0).toUpperCase();
                closeModal('usernameModal');
                addMessage('Ø³Ø³Ù¹Ù…', `Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯ØŒ ${myUsername}! Ú©Ù†Ú©Ø´Ù† Ø´Ø±ÙˆØ¹ Ú©Ø±Ù†Û’ Ú©Û’ Ù„ÛŒÛ’ ØªÛŒØ§Ø± ÛÛŒÚºÛ”`, 'received');
            }
        }
        
        // Ù¾ÛŒØ¦Ø± Ú©Ù†Ú©Ø´Ù† Ø´Ø±ÙˆØ¹ Ú©Ø±Ù†Ø§
        function startPeerConnection() {
            if (!peer) {
                // ÙˆÛŒØ¨ Ø¢Ø± Ù¹ÛŒ Ø³ÛŒ Ú†ÛŒÚ©
                if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
                    addMessage('Ø³Ø³Ù¹Ù…', 'ÙˆÛŒØ¨ Ø¢Ø± Ù¹ÛŒ Ø³ÛŒ Ø³Ù¾ÙˆØ±Ù¹ Ù†ÛÛŒÚº ÛÛ’Û” Ø¨Ø±Ø§Û Ú©Ø±Ù… Ø¬Ø¯ÛŒØ¯ Ø¨Ø±Ø§Ø¤Ø²Ø± Ø§Ø³ØªØ¹Ù…Ø§Ù„ Ú©Ø±ÛŒÚºÛ”', 'received');
                    return;
                }
                
                addMessage('Ø³Ø³Ù¹Ù…', 'Ú©Ù†Ú©Ø´Ù† Ø´Ø±ÙˆØ¹ ÛÙˆ Ø±ÛØ§ ÛÛ’...', 'received');
                
                // SimplePeer Ù„Ø§Ø¦Ø¨Ø±ÛŒØ±ÛŒ Ø§Ø³ØªØ¹Ù…Ø§Ù„ (WebRTC)
                // Ù†ÙˆÙ¹: Ø¹Ù…Ù„ÛŒ Ø§Ø³ØªØ¹Ù…Ø§Ù„ Ú©Û’ Ù„ÛŒÛ’ Ø¢Ù¾ Ú©Ùˆ signaling Ø³Ø±ÙˆØ± Ú©ÛŒ Ø¶Ø±ÙˆØ±Øª ÛÙˆÚ¯ÛŒ
                // ÛŒÛØ§Úº ØµØ±Ù ÚˆÛŒÙ…Ùˆ Ú©ÙˆÚˆ ÛÛ’
                
                // Ú©Ù†Ú©Ø´Ù† Ø§Ø³Ù¹ÛŒÙ¹Ø³ Ø§Ù¾ ÚˆÛŒÙ¹
                document.getElementById('connectionStatus').textContent = 'Ú©Ù†Ú©Ø´Ù† Ú©Ø§ Ø§Ù†ØªØ¸Ø§Ø±';
                document.getElementById('peerIdDisplay').innerHTML = `
                    <strong>Ú©Ù†Ú©Ø´Ù† Ú©Û’ Ù„ÛŒÛ’ Ø¢Ù¾ Ú©Ø§ ID:</strong><br>
                    <span style="color:#4cc9f0">${myPeerId}</span><br><br>
                    Ø¯ÙˆØ³Ø±Û’ ØµØ§Ø±Ù Ú©Ùˆ ÛŒÛ ID Ø¯ÛŒÚº ØªØ§Ú©Û ÙˆÛ Ø¢Ù¾ Ø³Û’ Ù…Ù†Ø³Ù„Ú© ÛÙˆ Ø³Ú©Û’
                `;
                
                addMessage('Ø³Ø³Ù¹Ù…', `Ø¢Ù¾ Ú©Ø§ Ú©Ù†Ú©Ø´Ù† ID: ${myPeerId} ÛÛ’Û” Ø¯ÙˆØ³Ø±Û’ ØµØ§Ø±Ù Ú©Ùˆ ÛŒÛ ID Ø¯ÛŒÚºÛ”`, 'received');
                
                // ÚˆÛŒÙ…Ùˆ Ú©Û’ Ù„ÛŒÛ’ Ú©Ù†Ú©Ø´Ù† Ú©Ø§ Ø¨Ù¹Ù† ØªØ¨Ø¯ÛŒÙ„ Ú©Ø±ÛŒÚº
                document.getElementById('voiceCallBtn').innerHTML = '<i class="fas fa-phone"></i><span>ÙˆØ§Ø¦Ø³ Ú©Ø§Ù„ (Ú©Ù†Ú©Ø´Ù† Ú©Û’ Ø¨Ø¹Ø¯)</span>';
                document.getElementById('videoCallBtn').innerHTML = '<i class="fas fa-video"></i><span>ÙˆÛŒÚˆÛŒÙˆ Ú©Ø§Ù„ (Ú©Ù†Ú©Ø´Ù† Ú©Û’ Ø¨Ø¹Ø¯)</span>';
                
                // ÚˆÛŒÙ…Ùˆ ØµØ§Ø±Ù Ø´Ø§Ù…Ù„ Ú©Ø±ÛŒÚº
                setTimeout(() => {
                    addDemoUser();
                }, 2000);
            } else {
                addMessage('Ø³Ø³Ù¹Ù…', 'Ú©Ù†Ú©Ø´Ù† Ù¾ÛÙ„Û’ Ø³Û’ Ø´Ø±ÙˆØ¹ ÛÛ’Û”', 'received');
            }
        }
        
        // Ù…ÙˆØ¬ÙˆØ¯Û Ú©Ù†Ú©Ø´Ù† Ù…ÛŒÚº Ø´Ø§Ù…Ù„ ÛÙˆÙ†Ø§
        function joinExistingConnection() {
            document.getElementById('connectModal').style.display = 'flex';
        }
        
        // Ù¾ÛŒØ¦Ø± Ø³Û’ Ù…Ù†Ø³Ù„Ú© ÛÙˆÙ†Ø§
        function connectToPeer() {
            const peerId = document.getElementById('peerIdInput').value.trim();
            if (!peerId) {
                addMessage('Ø³Ø³Ù¹Ù…', 'Ø¨Ø±Ø§Û Ú©Ø±Ù… Ù¾ÛŒØ¦Ø± Ø¢Ø¦ÛŒ ÚˆÛŒ Ø¯Ø±Ø¬ Ú©Ø±ÛŒÚºÛ”', 'received');
                return;
            }
            
            closeModal('connectModal');
            addMessage('Ø³Ø³Ù¹Ù…', `${peerId} Ø³Û’ Ù…Ù†Ø³Ù„Ú© ÛÙˆÙ†Û’ Ú©ÛŒ Ú©ÙˆØ´Ø´ Ú©Ø± Ø±ÛÛ’ ÛÛŒÚº...`, 'received');
            
            // ÚˆÛŒÙ…Ùˆ Ú©Û’ Ù„ÛŒÛ’ Ú©Ù†Ú©Ø´Ù† Ø¸Ø§ÛØ± Ú©Ø±ÛŒÚº
            setTimeout(() => {
                document.getElementById('connectionStatus').textContent = 'Ù…Ù†Ø³Ù„Ú©';
                addMessage('Ø³Ø³Ù¹Ù…', `${peerId} Ø³Û’ Ú©Ø§Ù…ÛŒØ§Ø¨ÛŒ Ø³Û’ Ù…Ù†Ø³Ù„Ú© ÛÙˆ Ú¯Ø¦Û’!`, 'received');
                addUserToList('Ø¯ÙˆØ³Ø±Ø§ ØµØ§Ø±Ù', peerId);
                
                // Ú©Ù†Ù¹Ø±ÙˆÙ„Ø² ÙØ¹Ø§Ù„ Ú©Ø±ÛŒÚº
                document.getElementById('voiceCallBtn').innerHTML = '<i class="fas fa-phone"></i><span>ÙˆØ§Ø¦Ø³ Ú©Ø§Ù„</span>';
                document.getElementById('videoCallBtn').innerHTML = '<i class="fas fa-video"></i><span>ÙˆÛŒÚˆÛŒÙˆ Ú©Ø§Ù„</span>';
                document.getElementById('callControls').style.display = 'flex';
            }, 1500);
        }
        
        // Ú©Ù†Ú©Ø´Ù† Ù…Ù†Ù‚Ø·Ø¹ Ú©Ø±Ù†Ø§
        function disconnectPeer() {
            if (confirm('Ú©ÛŒØ§ Ø¢Ù¾ ÙˆØ§Ù‚Ø¹ÛŒ Ú©Ù†Ú©Ø´Ù† Ù…Ù†Ù‚Ø·Ø¹ Ú©Ø±Ù†Ø§ Ú†Ø§ÛØªÛ’ ÛÛŒÚºØŸ')) {
                if (peerConnection) {
                    // Ø¹Ù…Ù„ÛŒ Ø§Ø³ØªØ¹Ù…Ø§Ù„ Ù…ÛŒÚº WebRTC Ú©Ù†Ú©Ø´Ù† Ø¨Ù†Ø¯ Ú©Ø±ÛŒÚº
                }
                
                document.getElementById('connectionStatus').textContent = 'Ù…Ù†Ø³Ù„Ú© Ù†ÛÛŒÚº';
                document.getElementById('peerIdDisplay').textContent = 'Ú©Ù†Ú©Ø´Ù† Ø´Ø±ÙˆØ¹ Ú©Ø±Ù†Û’ Ú©Ø§ Ø§Ù†ØªØ¸Ø§Ø±...';
                document.getElementById('usersList').innerHTML = '<div class="user-badge"><i class="fas fa-user"></i><span>Ú©ÙˆØ¦ÛŒ ØµØ§Ø±Ù Ù†ÛÛŒÚº</span></div>';
                
                addMessage('Ø³Ø³Ù¹Ù…', 'Ú©Ù†Ú©Ø´Ù† Ù…Ù†Ù‚Ø·Ø¹ Ú©Ø± Ø¯ÛŒØ§ Ú¯ÛŒØ§ ÛÛ’Û”', 'received');
                document.getElementById('callControls').style.display = 'none';
                voiceActive = false;
                videoActive = false;
            }
        }
        
        // Ù…ÛŒØ³Ø¬ Ø¨Ú¾ÛŒØ¬Ù†Ø§
        function sendMessage() {
            const input = document.getElementById('messageInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            // Ø§Ù¾Ù†Û’ Ú†ÛŒÙ¹ Ù…ÛŒÚº Ø¯Ú©Ú¾Ø§Ø¦ÛŒÚº
            addMessage(myUsername, message, 'sent');
            
            // ÚˆÛŒÙ…Ùˆ Ú©Û’ Ù„ÛŒÛ’ Ø¬ÙˆØ§Ø¨ÛŒ Ù…ÛŒØ³Ø¬
            setTimeout(() => {
                if (document.getElementById('connectionStatus').textContent === 'Ù…Ù†Ø³Ù„Ú©') {
                    const replies = [
                        "Ø¢Ù¾ Ú©ÛŒØ³Û’ ÛÛŒÚºØŸ",
                        "ÛŒÛ Ù¹ÛŒÚ©Ù†Ø§Ù„ÙˆØ¬ÛŒ Ø¨ÛØª Ø§Ú†Ú¾ÛŒ ÛÛ’!",
                        "Ú©ÛŒØ§ Ø¢Ù¾ Ú©Ùˆ ÛŒÛ Ø§ÛŒÙ¾ Ù¾Ø³Ù†Ø¯ Ø¢Ø¦ÛŒØŸ",
                        "Ù…ÛŒÚº Ø¨Ú¾ÛŒ ÛŒÛÛŒ Ø³ÙˆÚ† Ø±ÛØ§ ØªÚ¾Ø§Û”",
                        "Ú©Ù„ ÛÙ… Ù…Ù„ Ú©Ø± Ú©Ø§Ù… Ú©Ø± Ø³Ú©ØªÛ’ ÛÛŒÚºÛ”"
                    ];
                    const randomReply = replies[Math.floor(Math.random() * replies.length)];
                    addMessage('Ø¯ÙˆØ³Ø±Ø§ ØµØ§Ø±Ù', randomReply, 'received');
                }
            }, 1000);
            
            // Ø§Ù† Ù¾Ù¹ ØµØ§Ù Ú©Ø±ÛŒÚº
            input.value = '';
            input.focus();
        }
        
        // Ú©ÛŒ Ù¾Ø±ÛŒØ³ Ú©Û’ Ø°Ø±ÛŒØ¹Û’ Ù…ÛŒØ³Ø¬ Ø¨Ú¾ÛŒØ¬Ù†Ø§
        function handleKeyPress(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        }
        
        // ÙˆØ§Ø¦Ø³ Ú©Ø§Ù„ Ø´Ø±ÙˆØ¹ Ú©Ø±Ù†Ø§
        function startVoiceCall() {
            if (document.getElementById('connectionStatus').textContent !== 'Ù…Ù†Ø³Ù„Ú©') {
                addMessage('Ø³Ø³Ù¹Ù…', 'Ù¾ÛÙ„Û’ Ú©Ù†Ú©Ø´Ù† Ù‚Ø§Ø¦Ù… Ú©Ø±ÛŒÚºÛ”', 'received');
                return;
            }
            
            voiceActive = !voiceActive;
            const voiceBtn = document.getElementById('toggleVoiceBtn');
            
            if (voiceActive) {
                voiceBtn.classList.add('voice-active');
                addMessage('Ø³Ø³Ù¹Ù…', 'ÙˆØ§Ø¦Ø³ Ú©Ø§Ù„ Ø´Ø±ÙˆØ¹ ÛÙˆ Ú¯Ø¦ÛŒÛ”', 'received');
            } else {
                voiceBtn.classList.remove('voice-active');
                addMessage('Ø³Ø³Ù¹Ù…', 'ÙˆØ§Ø¦Ø³ Ú©Ø§Ù„ Ø¨Ù†Ø¯ ÛÙˆ Ú¯Ø¦ÛŒÛ”', 'received');
            }
        }
        
        // ÙˆÛŒÚˆÛŒÙˆ Ú©Ø§Ù„ Ø´Ø±ÙˆØ¹ Ú©Ø±Ù†Ø§
        function startVideoCall() {
            if (document.getElementById('connectionStatus').textContent !== 'Ù…Ù†Ø³Ù„Ú©') {
                addMessage('Ø³Ø³Ù¹Ù…', 'Ù¾ÛÙ„Û’ Ú©Ù†Ú©Ø´Ù† Ù‚Ø§Ø¦Ù… Ú©Ø±ÛŒÚºÛ”', 'received');
                return;
            }
            
            videoActive = !videoActive;
            const videoBtn = document.getElementById('toggleVideoBtn');
            
            if (videoActive) {
                videoBtn.classList.add('video-active');
                addMessage('Ø³Ø³Ù¹Ù…', 'ÙˆÛŒÚˆÛŒÙˆ Ú©Ø§Ù„ Ø´Ø±ÙˆØ¹ ÛÙˆ Ú¯Ø¦ÛŒÛ”', 'received');
            } else {
                videoBtn.classList.remove('video-active');
                addMessage('Ø³Ø³Ù¹Ù…', 'ÙˆÛŒÚˆÛŒÙˆ Ú©Ø§Ù„ Ø¨Ù†Ø¯ ÛÙˆ Ú¯Ø¦ÛŒÛ”', 'received');
            }
        }
        
        // ÙˆØ§Ø¦Ø³ Ø±ÛŒÚ©Ø§Ø±ÚˆÙ†Ú¯ Ù¹ÙˆÚ¯Ù„ Ú©Ø±Ù†Ø§
        function toggleVoiceRecording() {
            const voiceBtn = document.getElementById('voiceBtn');
            if (!voiceActive) {
                voiceActive = true;
                voiceBtn.classList.add('voice-active');
                addMessage('Ø³Ø³Ù¹Ù…', 'ÙˆØ§Ø¦Ø³ Ø±ÛŒÚ©Ø§Ø±ÚˆÙ†Ú¯ Ø´Ø±ÙˆØ¹ ÛÙˆ Ú¯Ø¦ÛŒÛ” Ø¨ÙˆÙ„Ù†Ø§ Ø´Ø±ÙˆØ¹ Ú©Ø±ÛŒÚºÛ”', 'received');
            } else {
                voiceActive = false;
                voiceBtn.classList.remove('voice-active');
                addMessage('Ø³Ø³Ù¹Ù…', 'ÙˆØ§Ø¦Ø³ Ø±ÛŒÚ©Ø§Ø±ÚˆÙ†Ú¯ Ø¨Ù†Ø¯ ÛÙˆ Ú¯Ø¦ÛŒÛ”', 'received');
            }
        }
        
        // Ú©Ø§Ù„ Ø®ØªÙ… Ú©Ø±Ù†Ø§
        function endCall() {
            voiceActive = false;
            videoActive = false;
            
            document.getElementById('toggleVoiceBtn').classList.remove('voice-active');
            document.getElementById('toggleVideoBtn').classList.remove('video-active');
            document.getElementById('voiceBtn').classList.remove('voice-active');
            
            addMessage('Ø³Ø³Ù¹Ù…', 'Ú©Ø§Ù„ Ø®ØªÙ… ÛÙˆ Ú¯Ø¦ÛŒÛ”', 'received');
        }
        
        // Ø§ÛŒÙ…ÙˆØ¬ÛŒ Ø¨Ú¾ÛŒØ¬Ù†Ø§
        function sendEmoji() {
            const emojis = ['ğŸ˜€', 'ğŸ˜‚', 'ğŸ¤”', 'ğŸ‘', 'â¤ï¸', 'ğŸ”¥', 'ğŸ‰', 'ğŸ™'];
            const randomEmoji = emojis[Math.floor(Math.random() * emojis.length)];
            addMessage(myUsername, randomEmoji, 'sent');
        }
        
        // ÙˆØ§Ø¦Ø³ Ú©Ø§Ù„ Ù¹ÙˆÚ¯Ù„
        function toggleVoiceCall() {
            startVoiceCall();
        }
        
        // ÙˆÛŒÚˆÛŒÙˆ Ú©Ø§Ù„ Ù¹ÙˆÚ¯Ù„
        function toggleVideoCall() {
            startVideoCall();
        }
        
        // Ú©Ù†Ú©Ø´Ù† Ø§Ø³Ù¹ÛŒÙ¹Ø³ Ø§Ù¾ ÚˆÛŒÙ¹
        function updateConnectionStatus() {
            // ÚˆÛŒÙ…Ùˆ Ú©Û’ Ù„ÛŒÛ’ Ø¨Ø§Ù‚Ø§Ø¹Ø¯Û Ø§Ù¾ ÚˆÛŒÙ¹
        }
        
        // ØµØ§Ø±Ù Ú©ÛŒ ÙÛØ±Ø³Øª Ù…ÛŒÚº Ø´Ø§Ù…Ù„ Ú©Ø±Ù†Ø§
        function addUserToList(name, id) {
            const usersList = document.getElementById('usersList');
            const userBadge = document.createElement('div');
            userBadge.className = 'user-badge';
            userBadge.innerHTML = `<i class="fas fa-user"></i><span>${name} (${id})</span>`;
            usersList.innerHTML = '';
            usersList.appendChild(userBadge);
        }
        
        // ÚˆÛŒÙ…Ùˆ ØµØ§Ø±Ù Ø´Ø§Ù…Ù„ Ú©Ø±Ù†Ø§
        function addDemoUser() {
            addUserToList('Ø¯ÙˆØ³Ø±Ø§ ØµØ§ÙØ±', 'xYz789Ab');
            document.getElementById('connectionStatus').textContent = 'Ù…Ù†Ø³Ù„Ú©';
            document.getElementById('callControls').style.display = 'flex';
            
            setTimeout(() => {
                addMessage('Ø³Ø³Ù¹Ù…', 'Ø¯ÙˆØ³Ø±Ø§ ØµØ§Ø±Ù Ø¢Ù¾ Ø³Û’ Ù…Ù†Ø³Ù„Ú© ÛÙˆ Ú¯ÛŒØ§ ÛÛ’Û” Ø§Ø¨ Ø¢Ù¾ Ú†ÛŒÙ¹ØŒ ÙˆØ§Ø¦Ø³ Ú©Ø§Ù„ Ø§ÙˆØ± ÙˆÛŒÚˆÛŒÙˆ Ú©Ø§Ù„ Ú©Ø± Ø³Ú©ØªÛ’ ÛÛŒÚºÛ”', 'received');
            }, 500);
        }
        
        // Ù…ÛŒØ³Ø¬ Ø´Ø§Ù…Ù„ Ú©Ø±Ù†Ø§
        function addMessage(sender, content, type) {
            const chatMessages = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message message-${type}`;
            
            const now = new Date();
            const time = `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}`;
            
            messageDiv.innerHTML = `
                <div class="message-bubble">
                    <div class="message-sender">${sender}</div>
                    <div class="message-content">${content}</div>
                    <div class="message-time">${time}</div>
                </div>
            `;
            
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }
        
        // Ø¢Ù Ù„Ø§Ø¦Ù† Ú©Ø§Ù… Ú©Û’ Ù„ÛŒÛ’ Ø³Ø±ÙˆØ³ ÙˆØ±Ú©Ø± Ø±Ø¬Ø³Ù¹Ø±ÛŒØ´Ù†
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js').then(() => {
                    console.log('Service Worker registered');
                }).catch(err => {
                    console.log('Service Worker registration failed:', err);
                });
            });
        }
    </script>
</body>
</html>