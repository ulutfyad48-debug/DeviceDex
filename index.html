<!DOCTYPE html>
<html lang="ur" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mobile Specs Pro - موبائل سپیکس ایکسپلورر</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --primary: #2563eb;
            --secondary: #1e40af;
            --accent: #3b82f6;
            --bg: #f8fafc;
            --card-bg: #ffffff;
            --text-main: #1e293b;
            --text-light: #64748b;
            --border: #e2e8f0;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }

        /* English LTR Override */
        body.ltr {
            direction: ltr;
            font-family: 'Segoe UI', system-ui, sans-serif;
        }
        body.ltr .search-container i { left: 20px; right: auto; }
        body.ltr #searchInput { padding: 18px 20px 18px 50px; }
        body.ltr .spec-item { border-right: none; border-left: 4px solid var(--primary); }
        body.ltr .close-btn { right: 20px; left: auto; }

        body {
            font-family: 'Segoe UI', 'Noto Nastaliq Urdu', system-ui, -apple-system, sans-serif;
            background-color: var(--bg);
            margin: 0;
            padding: 0;
            color: var(--text-main);
            transition: all 0.3s ease;
        }

        /* Header Styling */
        header {
            background: linear-gradient(135deg, #0f172a 0%, #1e3a8a 100%);
            color: white;
            padding: 50px 20px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        header::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: url('https://www.transparenttextures.com/patterns/cubes.png');
            opacity: 0.1;
        }

        .lang-toggle {
            position: absolute;
            top: 20px;
            left: 20px; /* RTL default */
            background: rgba(255,255,255,0.2);
            border: 1px solid rgba(255,255,255,0.3);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            backdrop-filter: blur(5px);
            z-index: 10;
        }
        body.ltr .lang-toggle { left: auto; right: 20px; }

        header h1 { margin: 0; font-size: 2.8rem; font-weight: 800; text-shadow: 0 2px 4px rgba(0,0,0,0.3); }
        header p { margin: 15px 0 30px; font-size: 1.2rem; opacity: 0.9; }

        /* Search Bar */
        .search-wrapper {
            max-width: 700px;
            margin: 0 auto;
            position: relative;
            z-index: 2;
        }

        .search-container { position: relative; }
        
        .search-container i {
            position: absolute;
            right: 25px; /* RTL default */
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-light);
            font-size: 1.2rem;
        }

        #searchInput {
            width: 100%;
            padding: 20px 60px 20px 25px; /* RTL Padding */
            font-size: 1.1rem;
            border: none;
            border-radius: 50px;
            box-shadow: 0 15px 30px rgba(0,0,0,0.2);
            outline: none;
            transition: transform 0.2s;
        }
        #searchInput:focus { transform: scale(1.02); }

        /* Main Grid */
        .container {
            max-width: 1300px;
            margin: -40px auto 40px; /* Overlap header */
            padding: 0 20px;
            position: relative;
            z-index: 3;
        }

        #results {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
            gap: 25px;
        }

        /* Card Design */
        .card {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 20px;
            box-shadow: var(--shadow);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid white;
            display: flex;
            flex-direction: column;
            cursor: pointer;
        }

        .card:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            border-color: var(--accent);
        }

        .card-img-wrapper {
            height: 220px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 15px;
            background: #f1f5f9;
            border-radius: 15px;
            overflow: hidden;
        }

        .card img { max-height: 90%; max-width: 90%; object-fit: contain; transition: transform 0.3s; }
        .card:hover img { transform: scale(1.1); }
        
        .card h3 {
            margin: 10px 0;
            font-size: 1.2rem;
            text-align: center;
            color: var(--text-main);
            font-weight: 700;
        }

        .tags {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            justify-content: center;
            margin-bottom: 15px;
        }
        .tag {
            background: #eff6ff;
            color: var(--primary);
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .btn-details {
            margin-top: auto;
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 12px;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: 0.3s;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 8px;
        }
        .btn-details:hover { background-color: var(--secondary); }

        /* Fallback Box */
        .fallback-box {
            grid-column: 1 / -1;
            background: white;
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            box-shadow: var(--shadow);
        }
        .fallback-btn {
            background: #ea580c;
            color: white;
            padding: 12px 30px;
            border-radius: 50px;
            text-decoration: none;
            display: inline-block;
            margin-top: 15px;
            font-weight: bold;
            transition: 0.3s;
        }
        .fallback-btn:hover { background: #c2410c; transform: translateY(-2px); }

        /* Modal */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(15, 23, 42, 0.8);
            backdrop-filter: blur(8px);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 20px;
            animation: fadeIn 0.3s;
        }

        .modal-content {
            background: var(--card-bg);
            width: 100%;
            max-width: 900px;
            max-height: 90vh;
            border-radius: 24px;
            overflow-y: auto;
            position: relative;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            display: flex;
            flex-direction: column;
        }

        .close-btn {
            position: absolute;
            top: 20px; left: 20px; /* RTL default */
            background: #f1f5f9;
            color: var(--text-main);
            border: none;
            border-radius: 50%;
            width: 40px; height: 40px;
            font-size: 1.2rem;
            cursor: pointer;
            transition: 0.2s;
            z-index: 20;
        }
        .close-btn:hover { background: #fee2e2; color: #ef4444; }

        /* Modal Body */
        .specs-header {
            background: #f8fafc;
            padding: 30px;
            display: flex;
            align-items: center;
            gap: 30px;
            border-bottom: 1px solid var(--border);
        }
        .specs-header img { width: 140px; height: auto; mix-blend-mode: multiply; }
        
        .specs-body { padding: 30px; }
        .specs-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .spec-item {
            background: #fff;
            padding: 15px;
            border-radius: 12px;
            border: 1px solid var(--border);
            border-right: 4px solid var(--primary); /* RTL default */
        }
        .spec-item strong { display: block; color: var(--text-light); font-size: 0.85rem; text-transform: uppercase; margin-bottom: 5px; }
        .spec-item span { font-size: 1.05rem; font-weight: 500; color: var(--text-main); }

        /* External Frame */
        #externalFrame {
            width: 100%;
            height: 600px;
            border: none;
            border-radius: 0 0 24px 24px;
        }
        .external-warning {
            padding: 15px;
            background: #fff7ed;
            color: #c2410c;
            text-align: center;
            font-size: 0.9rem;
            border-bottom: 1px solid #ffedd5;
        }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @media (max-width: 768px) {
            .specs-header { flex-direction: column; text-align: center; }
            header h1 { font-size: 2rem; }
        }
    </style>
</head>
<body>

    <header>
        <button class="lang-toggle" onclick="toggleLanguage()">
            <i class="fas fa-language"></i> <span id="langText">English</span>
        </button>
        <h1 id="siteTitle">موبائل سپیکس ایکسپلورر</h1>
        <p id="siteSubtitle">ہزاروں فونز کی تفصیلات، دو بڑے ڈیٹا بیسز سے</p>
        
        <div class="search-wrapper">
            <div class="search-container">
                <i class="fas fa-search"></i>
                <input type="text" id="searchInput" placeholder="موبائل کا نام لکھیں..." autocomplete="off">
            </div>
        </div>
    </header>

    <div class="container">
        <div id="results">
            <div style="grid-column: 1/-1; text-align: center; padding: 50px; color: #64748b;">
                <i class="fas fa-spinner fa-spin fa-3x"></i>
                <p style="margin-top: 20px;">ڈیٹا لوڈ ہو رہا ہے، براہ کرم انتظار کریں...</p>
            </div>
        </div>
        
        <div id="loadMoreContainer" style="text-align: center; margin-top: 30px; display: none;">
            <button onclick="loadMore()" style="background: white; border: 1px solid var(--border); padding: 10px 30px; border-radius: 30px; cursor: pointer; color: var(--primary); font-weight: bold;">
                <i class="fas fa-arrow-down"></i> <span class="txt-more">مزید دیکھیں</span>
            </button>
        </div>
    </div>

    <div class="modal-overlay" id="specsModal">
        <div class="modal-content">
            <button class="close-btn" onclick="closeSpecsModal()"><i class="fas fa-times"></i></button>
            <div id="modalBodyContent">
                </div>
        </div>
    </div>

    <div class="modal-overlay" id="externalModal">
        <div class="modal-content" style="height: 85vh; max-width: 1000px;">
            <button class="close-btn" onclick="closeExternalModal()"><i class="fas fa-times"></i></button>
            <div class="external-warning">
                <span class="txt-ext-warn">اگر ویب سائٹ نیچے لوڈ نہیں ہوتی (سیکیورٹی کی وجہ سے)، تو براہ راست کھولنے کے لیے یہاں کلک کریں:</span>
                <a href="#" id="directExternalLink" target="_blank" style="font-weight: bold; text-decoration: underline;">Open Link</a>
            </div>
            <iframe id="externalFrame" src=""></iframe>
        </div>
    </div>

    <script>
        // --- 1. CONFIGURATION & TRANSLATIONS ---
        const config = {
            files: ['mobiles.json', 'convertcsv (2).json'],
            itemsPerPage: 24,
            currentLang: 'ur'
        };

        const i18n = {
            ur: {
                title: "موبائل سپیکس ایکسپلورر",
                subtitle: "ہزاروں فونز کی تفصیلات، دو بڑے ڈیٹا بیسز سے",
                placeholder: "موبائل کا نام لکھیں (مثلاً Samsung Galaxy)...",
                details: "مکمل تفصیلات",
                notFound: "معذرت، ہمارے ڈیٹا بیس میں یہ فون نہیں ملا۔",
                searchExternal: "آن لائن تلاش کریں (PhoneArena)",
                ram: "ریم",
                storage: "میموری",
                battery: "بیٹری",
                camera: "کیمرہ",
                display: "ڈسپلے",
                more: "مزید دیکھیں",
                extWarn: "اگر ویب سائٹ لوڈ نہ ہو تو یہاں کلک کریں"
            },
            en: {
                title: "Mobile Specs Pro",
                subtitle: "Explore thousands of phones from dual databases",
                placeholder: "Search for a phone (e.g. iPhone 14)...",
                details: "View Specs",
                notFound: "Sorry, phone not found in local database.",
                searchExternal: "Search on PhoneArena",
                ram: "RAM",
                storage: "Storage",
                battery: "Battery",
                camera: "Camera",
                display: "Display",
                more: "Load More",
                extWarn: "If website doesn't load below, click here to open directly"
            }
        };

        let allMobiles = []; // Combined Data
        let filteredMobiles = []; // Search Results
        let displayCount = 0;

        // --- 2. DATA FETCHING & NORMALIZATION ---
        
        async function loadData() {
            try {
                // Fetch both files in parallel
                const [res1, res2] = await Promise.all([
                    fetch(config.files[0]),
                    fetch(config.files[1])
                ]);

                const data1 = await res1.json(); // mobiles.json
                const data2 = await res2.json(); // convertcsv (2).json

                // Normalize Data 1 (mobiles.json is already cleaner)
                const standardized1 = data1.map(item => ({
                    source: 'DB1',
                    brand: item.brand,
                    model: item.model,
                    img: item.img_url,
                    specs: {
                        'RAM': item.RAM,
                        'Storage': item.internal_memory,
                        'Battery': item.battery,
                        'Display': item.display_size || item.display_resolution,
                        'Camera': item.primary_camera,
                        'OS': item.OS,
                        'Processor': item.CPU
                    },
                    fullData: item // Keep original for modal
                }));

                // Normalize Data 2 (convertcsv (2).json has A,B,C keys)
                // Remove the first item if it contains headers (Brand Name, Model Name)
                if (data2.length > 0 && data2[0].A === "Brand Name") {
                    data2.shift();
                }

                const standardized2 = data2.map(item => ({
                    source: 'DB2',
                    brand: item.A, // A is Brand
                    model: item.B, // B is Model
                    img: item.AX || item.AR, // AX/AR usually contains image URL in this dataset
                    specs: {
                        'RAM': item.U, // Guessing based on common CSV structures or 'Internal Memory' slot
                        'Storage': item.U, // Often mixed in csv
                        'Battery': item.AL, 
                        'Display': item.L, // Display Size
                        'Camera': item.V, // Main Camera
                        'OS': item.P,
                        'Processor': item.R
                    },
                    fullData: item
                }));

                // Merge and Shuffle slightly to mix brands
                allMobiles = [...standardized1, ...standardized2];
                
                // Initial Render
                filteredMobiles = allMobiles;
                renderCards(true);

            } catch (error) {
                console.error("Error loading files:", error);
                document.getElementById('results').innerHTML = 
                    `<div class="fallback-box">
                        <h3>Error Loading Data</h3>
                        <p>Please ensure 'mobiles.json' and 'convertcsv (2).json' are in the same folder.</p>
                    </div>`;
            }
        }

        // --- 3. RENDERING LOGIC ---

        function renderCards(reset = false) {
            const container = document.getElementById('results');
            const loadMoreBtn = document.getElementById('loadMoreContainer');
            
            if (reset) {
                container.innerHTML = '';
                displayCount = 0;
            }

            if (filteredMobiles.length === 0) {
                showNoResults();
                loadMoreBtn.style.display = 'none';
                return;
            }

            const slice = filteredMobiles.slice(displayCount, displayCount + config.itemsPerPage);
            
            slice.forEach(phone => {
                const card = document.createElement('div');
                card.className = 'card';
                card.onclick = () => openSpecsModal(phone);

                // Fallback image
                const imgSrc = (phone.img && phone.img.length > 10) ? phone.img : 'https://via.placeholder.com/300x400?text=No+Image';
                
                // Dynamic Tags based on available specs
                let tagsHtml = '';
                if(phone.specs.RAM) tagsHtml += `<span class="tag">${phone.specs.RAM}</span>`;
                if(phone.specs.Battery) tagsHtml += `<span class="tag">${phone.specs.Battery.split(' ').slice(0,2).join(' ')}</span>`;

                const t = i18n[config.currentLang];

                card.innerHTML = `
                    <div class="card-img-wrapper">
                        <img src="${imgSrc}" loading="lazy" alt="${phone.brand} ${phone.model}" onerror="this.src='https://via.placeholder.com/300x400?text=Phone'">
                    </div>
                    <h3>${phone.brand} ${phone.model}</h3>
                    <div class="tags">${tagsHtml}</div>
                    <button class="btn-details">
                        ${t.details} <i class="fas fa-arrow-${config.currentLang === 'ur' ? 'left' : 'right'}"></i>
                    </button>
                `;
                container.appendChild(card);
            });

            displayCount += slice.length;

            // Handle Load More visibility
            if (displayCount < filteredMobiles.length) {
                loadMoreBtn.style.display = 'block';
            } else {
                loadMoreBtn.style.display = 'none';
            }
        }

        function loadMore() {
            renderCards(false);
        }

        function showNoResults() {
            const container = document.getElementById('results');
            const t = i18n[config.currentLang];
            const query = document.getElementById('searchInput').value;
            
            container.innerHTML = `
                <div class="fallback-box">
                    <i class="fas fa-search-minus fa-3x" style="color: #cbd5e1; margin-bottom: 20px;"></i>
                    <h3>${t.notFound}</h3>
                    <p>${query} ?</p>
                    <a href="javascript:void(0)" onclick="openExternalSearch('${query}')" class="fallback-btn">
                        <i class="fas fa-globe"></i> ${t.searchExternal}
                    </a>
                </div>
            `;
        }

        // --- 4. SEARCH LOGIC ---

        document.getElementById('searchInput').addEventListener('input', (e) => {
            const query = e.target.value.toLowerCase().trim();
            if (!query) {
                filteredMobiles = allMobiles;
            } else {
                filteredMobiles = allMobiles.filter(item => 
                    (item.brand && item.brand.toLowerCase().includes(query)) ||
                    (item.model && item.model.toLowerCase().includes(query))
                );
            }
            renderCards(true);
        });

        // --- 5. MODALS & INTERACTION ---

        function openSpecsModal(phone) {
            const modal = document.getElementById('specsModal');
            const body = document.getElementById('modalBodyContent');
            const imgSrc = (phone.img && phone.img.length > 10) ? phone.img : 'https://via.placeholder.com/300x400?text=No+Image';

            // Generate Specs List
            let specsHtml = '';
            
            // Helper to clean keys
            const formatKey = (key) => key.replace(/_/g, ' ').replace(/([A-Z])/g, ' $1').trim();

            // Merge explicit specs with full raw data for completeness
            const allData = { ...phone.specs, ...phone.fullData };
            
            // Filter out junk keys
            const junkKeys = ['img_url', 'source', 'fullData', 'specs', 'A', 'B', 'AX', 'AR', 'brand', 'model', 'img'];

            for (const [key, val] of Object.entries(allData)) {
                if (val && !junkKeys.includes(key) && val.toString().length < 100) {
                    specsHtml += `
                        <div class="spec-item">
                            <strong>${formatKey(key)}</strong>
                            <span>${val}</span>
                        </div>
                    `;
                }
            }

            body.innerHTML = `
                <div class="specs-header">
                    <img src="${imgSrc}" alt="${phone.brand}">
                    <div>
                        <h2 style="margin:0; font-size: 2rem; color: var(--text-main);">${phone.brand} ${phone.model}</h2>
                        <span style="background: #e0f2fe; color: var(--primary); padding: 5px 10px; border-radius: 5px; font-size: 0.9rem; margin-top: 10px; display:inline-block;">
                            Source: ${phone.source === 'DB1' ? 'Database A' : 'Database B'}
                        </span>
                    </div>
                </div>
                <div class="specs-body">
                    <div class="specs-grid">
                        ${specsHtml}
                    </div>
                </div>
            `;

            modal.style.display = 'flex';
            document.body.style.overflow = 'hidden';
        }

        function closeSpecsModal() {
            document.getElementById('specsModal').style.display = 'none';
            document.body.style.overflow = 'auto';
        }

        // --- 6. EXTERNAL SEARCH (FALLBACK) ---

        function openExternalSearch(query) {
            const modal = document.getElementById('externalModal');
            const iframe = document.getElementById('externalFrame');
            const directLink = document.getElementById('directExternalLink');

            // PhoneArena Search Logic
            // PhoneArena uses a specific search URL structure or simply opens the main page
            const searchUrl = `https://www.phonearena.com/search/term/${encodeURIComponent(query)}`;
            const fallbackUrl = `https://www.phonearena.com/phones`; // Safer for iframe as search pages often break frames

            iframe.src = fallbackUrl; 
            directLink.href = searchUrl; // The button opens the actual search
            
            modal.style.display = 'flex';
        }

        function closeExternalModal() {
            document.getElementById('externalModal').style.display = 'none';
            document.getElementById('externalFrame').src = ""; // Stop loading
        }

        // --- 7. LANGUAGE TOGGLE ---

        function toggleLanguage() {
            config.currentLang = config.currentLang === 'ur' ? 'en' : 'ur';
            const t = i18n[config.currentLang];
            const isRTL = config.currentLang === 'ur';

            // HTML Dir
            document.documentElement.dir = isRTL ? 'rtl' : 'ltr';
            if(isRTL) document.body.classList.remove('ltr');
            else document.body.classList.add('ltr');

            // UI Text Updates
            document.getElementById('siteTitle').innerText = t.title;
            document.getElementById('siteSubtitle').innerText = t.subtitle;
            document.getElementById('searchInput').placeholder = t.placeholder;
            document.getElementById('langText').innerText = isRTL ? 'English' : 'اردو';
            
            // Text inside dynamic elements
            document.querySelectorAll('.txt-more').forEach(el => el.innerText = t.more);
            document.querySelectorAll('.txt-ext-warn').forEach(el => el.innerText = t.extWarn);

            // Re-render to update card button text and direction
            renderCards(true);
        }

        // Initialize
        loadData();

    </script>
</body>
</html>
